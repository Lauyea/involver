@page
@model Involver.Pages.StatisticalData.PartialViewRecordModel
@{
    Layout = null;
}

<div class="modal fade" id="viewRecordModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalLabel">@Model.Title - 過去30日觀看紀錄</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <canvas id="viewRecordChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script>
    var labels = @Html.AntiXssRaw(Model.DateArrJson);

    var data = {
        labels: labels,
        datasets: [{
            type: 'bar',
            label: '每日觀看數',
            backgroundColor: 'rgba(255, 200, 132, 0.5)',
            borderColor: 'rgb(255, 200, 132)',
            data: @Html.AntiXssRaw(Model.ViewCountArrJson),
            yAxisID: 'y'
        }, {
            type: 'line',
            label: '累積觀看數',
            backgroundColor: 'rgba(54, 162, 235, 0.5)',
            borderColor: 'rgb(54, 162, 235)',
            data: @Html.AntiXssRaw(Model.CumulativeViewCountArrJson),
            tension: 0.1,
            fill: false,
            yAxisID: 'y1'
        }]
    };

    var config = {
        type: 'bar',
        data: data,
        options: {
            scales: {
                y: {
                    type: 'linear',
                    display: true,
                    position: 'left',
                    beginAtZero: true,
                    ticks: {
                        precision: 0
                    },
                    title: {
                        display: true,
                        text: '每日觀看數'
                    }
                },
                y1: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    grid: {
                        drawOnChartArea: false
                    },
                    ticks: {
                        precision: 0
                    },
                    title: {
                        display: true,
                        text: '累積觀看數'
                    }
                }
            }
        }
    };

    // Ensure old chart is destroyed before creating a new one if needed, though loading into a clean div should prevent this.
    var existingChart = Chart.getChart("viewRecordChart");
    if (existingChart) {
        existingChart.destroy();
    }

    var viewRecordChart = new Chart(
        document.getElementById('viewRecordChart'),
        config
    );
</script>